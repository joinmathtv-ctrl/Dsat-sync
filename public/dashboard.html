<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DSAT Dashboard â€” Extended</title>

<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<!-- ê³µí†µ ìŠ¤íƒ€ì¼ & í”„ë¦¬ì…‹ -->
<link rel="stylesheet" href="./assets/style.css">
<script src="./assets/curves.presets.js"></script>

<style>
  /* â–¼ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ë§Œ ìœ ì§€ (ê³µí†µ style.cssì™€ ì¤‘ë³µ ì œê±° ì™„ë£Œ) */
  .r{ display:flex; gap:8px; flex-wrap:wrap; align-items:center }
  textarea.code{ width:100%; min-height:180px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace }
  input[type="date"]{
    border:1px solid var(--line);
    background:#fff;
    padding:8px 12px;
    border-radius:10px;
    cursor:pointer;
    font-size:14px;
  }
  /* â–¼ í† ìŠ¤íŠ¸ (ëŒ€ì‹œë³´ë“œ ë‚´ ìµœì†Œ ìŠ¤íƒ€ì¼) */
  .toast{
    position:fixed; bottom:12px; left:50%; transform:translateX(-50%);
    background:#222; color:#fff; padding:8px 12px; border-radius:8px;
    opacity:.95; transition:opacity .2s; z-index:9999;
  }
  .toast.ok{ background:#16a34a }
  .toast.err{ background:#dc2626 }
</style>
</head>
<body>
<div class="topbar">
  <div class="toprow">
    <div style="font-weight:800">ğŸ“ˆ DSAT Dashboard â€” Extended</div>
    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
      <a class="back" href="./index.html">â† ì—°ìŠµìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
      <span class="muted">|</span>
      <button class="btn" id="clearBtn">ì „ì²´ ë¡œê·¸ ì‚­ì œ</button>
      <button class="btn" id="importBtn">Import</button>
      <button class="btn" id="exportBtn">Export</button>
      <button class="btn" id="printBtn">ì¸ì‡„/ì €ì¥(PDF)</button>
    </div>
  </div>
</div>

<!-- Sync Panel -->
<div class="card" id="syncCard" data-sync-panel style="margin-top:12px">
  <div class="head"><div class="title">Sync</div></div>
  <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center">
    <button class="btn" id="btnSyncNow">Sync Now</button>
    <button class="btn" id="btnPush">Push Only</button>
    <button class="btn" id="btnPull">Pull Only</button>
    <!-- ë”í‹° ë°°ì§€: DSAT_SYNC ë™ì‘ ì‹œ ì—…ë°ì´íŠ¸ -->
    <span id="syncBadge" class="pill" style="display:none"></span>
    <span class="muted" id="syncStatus">â€”</span>
  </div>
</div>

<div class="wrap">
  <!-- í•„í„° + í”„ë¦¬ì…‹ ìŠ¤ìœ„ì²˜ + ê¸°ë³¸ í”„ë¦¬ì…‹ ì €ì¥ -->
  <div class="card">
    <div class="head">
      <div class="title">í•„í„° Â· ì»¤ë¸Œ Â· ê¸°ë³¸ê°’</div>
      <div class="r">
        <label class="muted">ì„¸íŠ¸:</label>
        <select id="baseSelect"></select>
        <label class="muted">ë³´ê¸°:</label>
        <select id="kindSelect">
          <option value="">ì „ì²´</option>
          <option value="base">Base</option>
          <option value="review">Review</option>
        </select>
        <label class="muted">ì»¤ë¸Œ í”„ë¦¬ì…‹(ë³´ê¸° ì¬ê³„ì‚°):</label>
        <select id="presetSelect"></select>
        <button class="btn" id="saveDefaultPresetBtn" title="í•´ë‹¹ ì„¸íŠ¸ì— ê¸°ë³¸ í”„ë¦¬ì…‹ ê¸°ì–µ(ë¡œì»¬)">ì´ ì„¸íŠ¸ ê¸°ë³¸ í”„ë¦¬ì…‹ìœ¼ë¡œ ì €ì¥</button>
        <span id="countInfo" class="pill muted"></span>
      </div>
    </div>

    <div class="r">
      <button class="btn ghost" id="openCurveEditor">í”„ë¦¬ì…‹ í¸ì§‘/ì¶”ê°€</button>
      <span class="muted" style="font-size:13px">
        * ë³´ê¸° í”„ë¦¬ì…‹ì€ <b>í‘œì‹œë§Œ ì¬ê³„ì‚°</b>í•©ë‹ˆë‹¤. ì‹¤ì œ ê¸°ë¡ ì‹œ ì‚¬ìš©ëœ í”„ë¦¬ì…‹ì€ ì—°ìŠµí˜ì´ì§€ì˜ <code>SET.metadata.curvePreset</code> ê°’ì…ë‹ˆë‹¤.
      </span>
    </div>

    <!-- â–¼ ë¦¬ë·° ë”¥ë§í¬ ë²„íŠ¼ -->
    <div class="r" style="margin-top:8px">
      <button class="btn" id="startWrongReviewBtn">ì˜¤ë‹µë§Œ ë¦¬ë·° ì‹œì‘</button>
      <button class="btn" id="startFlaggedReviewBtn">í”Œë˜ê·¸ë§Œ ë¦¬ë·° ì‹œì‘</button>
      <span class="muted" style="font-size:12px">* index.htmlì˜ í˜„ì¬ ì„¸íŠ¸ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.</span>
    </div>

    <!-- â–¼ ë‚ ì§œ ë²”ìœ„ + ì§‘ê³„ ëª¨ë“œ (ì¶”ê°€) -->
    <div class="r" style="margin-top:8px">
      <label class="muted">ë‚ ì§œ:</label>
      <input type="date" id="fromDate"/>
      <span class="muted">~</span>
      <input type="date" id="toDate"/>
      <span class="muted" style="margin-left:10px">ì§‘ê³„:</span>
      <select id="aggMode" title="ìš”ì•½ ì§‘ê³„ ëª¨ë“œ">
        <option value="">ì§‘ê³„ ì—†ìŒ</option>
        <option value="byPreset">í”„ë¦¬ì…‹ë³„ ì§‘ê³„</option>
        <option value="bySet">ì„¸íŠ¸ë³„ ì§‘ê³„</option>
      </select>
    </div>
  </div>

  <!-- ìƒë‹¨ ë©”íŠ¸ë¦­ -->
  <div class="row" style="margin-top:14px">
    <div class="card">
      <div class="head"><div class="title">ì´ì  ì¶”ì´ (SAT)</div></div>
      <canvas id="satLine" height="160"></canvas>
    </div>
    <div class="card">
      <div class="head"><div class="title">ì„¹ì…˜ë³„ í™˜ì‚° ì ìˆ˜</div></div>
      <canvas id="sectionBar" height="160"></canvas>
    </div>
  </div>

  <!-- ìŠ¤í‚¬ ì¶”ì´ & íˆíŠ¸ë§µ -->
  <div class="row" style="margin-top:14px">
    <div class="card">
      <div class="head">
        <div class="title">ìŠ¤í‚¬ ì¶”ì´ (ì •í™•ë„ %)</div>
        <div class="r">
          <select id="skillSelect"></select>
          <button class="btn" id="skillAllBtn">Top-ë³€ë™ ìŠ¤í‚¬ ì¶”ì²œ</button>
          <button class="btn" id="startSkillReviewBtn">ì´ ìŠ¤í‚¬ë¡œ ë¦¬ë·° ì‹œì‘</button>
        </div>
      </div>
      <canvas id="skillLine" height="160"></canvas>
    </div>
    <div class="card">
      <div class="head">
        <div class="title">ìŠ¤í‚¬ íˆíŠ¸ë§µ (ì •í™•ë„ %)</div>
        <div class="legend">
          <span class="cell c-0">0</span>0â€“50
          <span class="cell c-50">50</span>50â€“70
          <span class="cell c-70">70</span>70â€“85
          <span class="cell c-85">85</span>85â€“95
          <span class="cell c-95">95</span>95â€“100
        </div>
      </div>
      <div id="heatHdr" class="heatmap" style="grid-template-rows:auto"></div>
      <div id="heatBody" class="heatmap"></div>
    </div>
  </div>

  <!-- ì‹œë„ ë¹„êµ + ìƒì„¸ -->
  <div class="card" style="margin-top:14px">
    <div class="head">
      <div class="title">ì‹œë„ ë¹„êµ</div>
      <div class="r">
        <select id="cmpA"></select>
        <span class="muted">vs</span>
        <select id="cmpB"></select>
        <button class="btn" id="cmpBtn">ë¹„êµ</button>
        <button class="btn ghost" id="openDetailA">A ìƒì„¸</button>
        <button class="btn ghost" id="openDetailB">B ìƒì„¸</button>
      </div>
    </div>
   <div id="cmpOut" class="cmp-grid"></div>
  </div>

  <!-- ì§‘ê³„ ê²°ê³¼ (ì¶”ê°€) -->
  <div class="card" id="aggCard" style="margin-top:14px; display:none">
    <div class="head">
      <div class="title">ì§‘ê³„ ìš”ì•½</div>
      <div class="muted" id="aggCaption" style="font-size:13px"></div>
    </div>
    <div id="aggOut"></div>
  </div>

  <!-- ì‹œë„ ëª©ë¡ -->
  <div class="card" style="margin-top:14px">
    <div class="head">
      <div class="title">ì‹œë„ ëª©ë¡</div>
    </div>
    <div class="muted" style="font-size:13px; margin-bottom:8px">ìµœì‹ ìˆœ Â· í–‰ í´ë¦­ ì‹œ ìƒì„¸</div>
    <table id="attemptTable">
      <thead>
        <tr>
          <th style="width:160px">ì¼ì‹œ</th>
          <th>ì„¸íŠ¸ ì œëª©</th>
          <th>ì¢…ë¥˜</th>
          <th class="right">RW (ì›/í™˜ì‚°)</th>
          <th class="right">Math (ì›/í™˜ì‚°)</th>
          <th class="right">ì´ì </th>
          <th class="right">í”„ë¦¬ì…‹</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- ===== ëª¨ë‹¬: ì‹œë„ ìƒì„¸ ===== -->
<div class="backdrop" id="detailBack">
  <div class="modal">
    <button class="x" id="detailClose">ë‹«ê¸°</button>
    <div id="detailBody"></div>
  </div>
</div>

<!-- ===== ëª¨ë‹¬: ì»¤ë¸Œ ì—ë””í„° ===== -->
<div class="backdrop" id="curveBack">
  <div class="modal">
    <button class="x" id="curveClose">ë‹«ê¸°</button>
    <div class="head"><div class="title">ì»¤ë¸Œ í”„ë¦¬ì…‹ í¸ì§‘/ì¶”ê°€</div></div>
    <div class="r" style="margin-bottom:8px">
      <label class="muted">í”„ë¦¬ì…‹ ì„ íƒ:</label>
      <select id="editPreset"></select>
      <input id="newPresetName" type="text" placeholder="ìƒˆ í”„ë¦¬ì…‹ ì´ë¦„"/>
      <button class="btn" id="dupBtn">ë³µì‚¬â†’ìƒˆì´ë¦„</button>
      <button class="btn bad" id="delBtn">ì‚­ì œ</button>
    </div>
    <div class="grid" style="grid-template-columns:1fr 1fr; gap:12px">
      <div>
        <div class="muted" style="margin-bottom:6px">RW í¬ì¸íŠ¸ (JSON, ì˜ˆ: [[0,200],[20,300],...])</div>
        <textarea id="rwPoints" class="code"></textarea>
      </div>
      <div>
        <div class="muted" style="margin-bottom:6px">Math í¬ì¸íŠ¸ (JSON)</div>
        <textarea id="mathPoints" class="code"></textarea>
      </div>
    </div>
    <div class="r" style="margin-top:10px">
      <button class="btn" id="saveCurveBtn">ì €ì¥</button>
      <span class="muted">â€» xâ‰¤100 â†’ ì •ë‹µë¥ (%), x>100 â†’ ë§íŒê°œìˆ˜ ë„ë©”ì¸</span>
    </div>
  </div>
</div>

<!-- í† ìŠ¤íŠ¸ -->
<div id="toast" class="toast" aria-live="polite" aria-atomic="true" role="status"></div>

<!-- ë™ê¸°í™” ëª¨ë“ˆ (ìˆœì„œ ì¤‘ìš”: sync.js â†’ dashboard.js) -->
<script src="./sync.js"></script>
<script src="./assets/dashboard.js"></script>

<!-- Firebase SDKs (í•„ìš” ì‹œ) -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

</body>
</html>
